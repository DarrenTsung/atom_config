var lodash_1 = require("lodash");
exports.enqueue = (function () {
    var _queue = [];
    var _queueFinished = true;
    var requestAnimationFrame = window && window.requestAnimationFrame || function (cb) { lodash_1.delay(cb, 33); return -1; };
    var _raf = function () { return requestAnimationFrame(function () { return _dequeue(); }); };
    function _dequeue() {
        var framesToFinish = Math.min(Math.ceil(_queue.length / 20), 5);
        var queue = _queue.splice(0, framesToFinish);
        lodash_1.each(queue, function (cb) { return cb(); });
        if (_queue.length) {
            _raf();
        }
        else {
            _queueFinished = true;
        }
    }
    return function _enqueue(cb) {
        _queue.push(cb);
        if (_queueFinished) {
            _queueFinished = false;
            _raf();
        }
    };
})();
